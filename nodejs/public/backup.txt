<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0" name="viewport">
	<title>Altis</title>
	<link href="css/leaflet.css" rel="stylesheet">
	<link href="css/mapUtils.css" rel="stylesheet">
</head>
<body style="margin:0;padding:0;border:0;">
	<div class="map" id="map" style="width:100%; height:100vh; margin:0;padding:0;border:0;"></div>
	<script src="js/leaflet.js">
	</script>
	<script src="js/jquery.min.js">
	</script>
	<script src="js/mapUtils.js">
	</script>
	<script src="js/altis.js">
	</script>
	<script>
	$(function() {
    var mapInfos = Arma3Map.Maps.altis;

    var map = L.map("map", {
        crs: mapInfos.CRS,
    });

    L.tileLayer("/maps/altis/{z}/{x}/{y}.png", {
        attribution: mapInfos.attribution,
        tileSize: mapInfos.tileSize,
        maxNativeZoom: 6,
        maxZoom: 8,
        minZoom: 3,
        opacity: 0.6
    }).addTo(map);
    var layerGroup = L.layerGroup().addTo(map);

    map.setView(mapInfos.center, mapInfos.defaultZoom);

    L.latlngGraticule().addTo(map);

    L.control.scale({
        maxWidth: 200,
        imperial: false
    }).addTo(map);

    L.control.gridMousePosition().addTo(map);

    L.Control.textbox = L.Control.extend({
        onAdd: function(map) {
            var text = L.DomUtil.create('div');
            text.id = "info_text";
            text.innerHTML = "<strong style='color:white'>Arma 3 External Radar<br>v1.7 by Async<\/strong>"
            return text;
        },
        onRemove: function(map) {
        }
    });
    L.control.textbox = function(opts) {
        return new L.Control.textbox(opts);
    }
    L.control.textbox({
        position: 'bottomright'
    }).addTo(map);

	var soldier = 28531;
	var hellicopter = 25960;
	var car = 24931;
	var tank = 24948;
	var airplane = 26977;
	var ship = 26739;

    var CivIcon = L.icon({
    iconUrl: 'img/civ.png',
    iconSize:     [12, 12], 
    });

    var CivCar = L.icon({
    iconUrl: 'img/civcar.png',
    iconSize:     [16, 16], 
    });

    var CivHeli = L.icon({
    iconUrl: 'img/civheli.png',
    iconSize:     [16, 16], 
    });

    var CopIcon = L.icon({
    iconUrl: 'img/cop.png',
    iconSize:     [12, 12],
    });

    var CopCar = L.icon({
    iconUrl: 'img/copcar.png',
    iconSize:     [16, 16],
    });

    var CopHeli = L.icon({
    iconUrl: 'img/copheli.png',
    iconSize:     [16, 16],
    });

    var FactionIcon = L.icon({
    iconUrl: 'img/faction.png',
    iconSize:     [12, 12], 
    });

    var FactionCar = L.icon({
    iconUrl: 'img/factioncar.png',
    iconSize:     [16, 16], 
    });

    var FactionHeli = L.icon({
    iconUrl: 'img/factionheli.png',
    iconSize:     [16, 16], 
    });

    var MedicIcon = L.icon({
    iconUrl: 'img/medic.png',
    iconSize:     [12, 12], 
    });

    var MedicCar = L.icon({
    iconUrl: 'img/mediccar.png',
    iconSize:     [16, 16], 
    });

    var MedicHeli = L.icon({
    iconUrl: 'img/medicheli.png',
    iconSize:     [16, 16], 
    });


    $.ajax({
    type: "Get",
    url: "coords.json",
    dataType: "json",
    success: function(data) {
        for (var key in json1.coords) {
                if (json1.coords[key].IsDead === 1) { continue; }

                var latLng = L.latLng([json1.coords[key].x, json1.coords[key].y]);
                
                if (json1.coords[key].PlayerSide == 0) { // FACTION

                    if  (json1.coords[key].EntType == soldier) {
                        L.marker(latLng, {icon: FactionIcon, rotationAngle: json1.coords[key].PlayerDirection}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == car) {
                        L.marker(latLng, {icon: FactionCar}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == hellicopter || json1.coords[key].EntType == airplane) {
                        L.marker(latLng, {icon: FactionHeli}).addTo(layerGroup);
                    }

                } else if (json1.coords[key].PlayerSide == 1) { // COP

                    if  (json1.coords[key].EntType == soldier) {
                        L.marker(latLng, {icon: CopIcon, rotationAngle: json1.coords[key].PlayerDirection}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == car) {
                        L.marker(latLng, {icon: CopCar}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == hellicopter || json1.coords[key].EntType == airplane) {
                        L.marker(latLng, {icon: CopHeli}).addTo(layerGroup);
                    }

                } else if (json1.coords[key].PlayerSide == 2) { // MEDIC

                    if  (json1.coords[key].EntType == soldier) {
                        L.marker(latLng, {icon: MedicIcon, rotationAngle: json1.coords[key].PlayerDirection}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == car) {
                        L.marker(latLng, {icon: MedicCar}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == hellicopter || json1.coords[key].EntType == airplane) {
                        L.marker(latLng, {icon: MedicHeli}).addTo(layerGroup);
                    }

                } else if (json1.coords[key].PlayerSide == 3) { // CIV

                    if  (json1.coords[key].EntType == soldier) {
                        L.marker(latLng, {icon: CivIcon, rotationAngle: json1.coords[key].PlayerDirection}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == car) {
                        L.marker(latLng, {icon: CivCar}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == hellicopter || json1.coords[key].EntType == airplane) {
                        L.marker(latLng, {icon: CivHeli}).addTo(layerGroup);
                    }
                    
                } else {
                    continue;
                }
            }
    },
    error: function(){
        alert("json not found");
    }
});


    function update_position() {
        try 
        {
            $.getJSON("coords.json", function(json1) {
                console.log('Unable to load json3')
            layerGroup.clearLayers();
            try {
                for (var key in json1.coords) {
                if (json1.coords[key].IsDead === 1) { continue; }

                var latLng = L.latLng([json1.coords[key].x, json1.coords[key].y]);
                
                if (json1.coords[key].PlayerSide == 0) { // FACTION

                    if  (json1.coords[key].EntType == soldier) {
                        L.marker(latLng, {icon: FactionIcon, rotationAngle: json1.coords[key].PlayerDirection}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == car) {
                        L.marker(latLng, {icon: FactionCar}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == hellicopter || json1.coords[key].EntType == airplane) {
                        L.marker(latLng, {icon: FactionHeli}).addTo(layerGroup);
                    }

                } else if (json1.coords[key].PlayerSide == 1) { // COP

                    if  (json1.coords[key].EntType == soldier) {
                        L.marker(latLng, {icon: CopIcon, rotationAngle: json1.coords[key].PlayerDirection}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == car) {
                        L.marker(latLng, {icon: CopCar}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == hellicopter || json1.coords[key].EntType == airplane) {
                        L.marker(latLng, {icon: CopHeli}).addTo(layerGroup);
                    }

                } else if (json1.coords[key].PlayerSide == 2) { // MEDIC

                    if  (json1.coords[key].EntType == soldier) {
                        L.marker(latLng, {icon: MedicIcon, rotationAngle: json1.coords[key].PlayerDirection}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == car) {
                        L.marker(latLng, {icon: MedicCar}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == hellicopter || json1.coords[key].EntType == airplane) {
                        L.marker(latLng, {icon: MedicHeli}).addTo(layerGroup);
                    }

                } else if (json1.coords[key].PlayerSide == 3) { // CIV

                    if  (json1.coords[key].EntType == soldier) {
                        L.marker(latLng, {icon: CivIcon, rotationAngle: json1.coords[key].PlayerDirection}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == car) {
                        L.marker(latLng, {icon: CivCar}).addTo(layerGroup);
                    } else if (json1.coords[key].EntType == hellicopter || json1.coords[key].EntType == airplane) {
                        L.marker(latLng, {icon: CivHeli}).addTo(layerGroup);
                    }
                    
                } else {
                    continue;
                }
            }
            } catch (error) {
                console.log('Unable to load json3')
            }

            setTimeout(update_position, 800);
        });
        }
        catch(error) 
        {
            console.log('Unable to load json2')
        }

    }
    try
    {
        update_position();
    }
    catch (error) {
        console.log('Unable to load json1')
    }

	});
	</script>
</body>
</html>
